# JavaScript é—­åŒ…ï¼ˆClosureï¼‰ç¬”è®°

[ğŸ‘‰ MDN å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Closures)

---

## **âœ… é—­åŒ…åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ**

> é—­åŒ…æ˜¯
> **å‡½æ•° + å®ƒå®šä¹‰æ—¶çš„å˜é‡ç¯å¢ƒ**

> æ„æ€æ˜¯ï¼š
> **å‡½æ•°è®°ä½äº†å®ƒå½“æ—¶å¯ä»¥è®¿é—®çš„å¤–éƒ¨å˜é‡**
> 
---

## **âœ… æœ€ç®€å•ä¾‹å­**

```js
function outer() {
  let message = "hello";
  return function inner() {
    console.log(message);
  };
}

const fn = outer(); // outer æ‰§è¡Œå®Œäº†ï¼Œmessage ç†è®ºä¸Šåº”è¯¥æ²¡äº†
fn(); // ä½†è¿˜èƒ½æ‰“å° "hello"ï¼è¯´æ˜ message è¢«â€œé—­â€ä½äº†
```

---

## **âœ… é—­åŒ…çš„å…¸å‹ç”¨é€”ï¼šè®°ä½çŠ¶æ€**

```js
function createCounter() {
  let count = 0;
  return function () {
    count++;
    console.log(count);
  };
}

const counter = createCounter();
counter(); // 1
counter(); // 2
counter(); // 3
```

è¿™ä¸ª count å¤–é¢è®¿é—®ä¸åˆ°ï¼Œä½† counter å†…éƒ¨çš„é—­åŒ…å‡½æ•°å¯ä»¥ä¸€ç›´è®¿é—®ï¼

---

## **â— ç»å…¸é—­åŒ…â€œé™·é˜±â€é—®é¢˜**

```js
for (var i = 0; i < 3; i++) {
  setTimeout(() => {
    console.log(i);
  }, 1000);
}
```

ä½ ä»¥ä¸ºè¾“å‡ºæ˜¯ï¼š

```js
0
1
2
```

ä½†å®é™…è¾“å‡ºæ˜¯ï¼š

```js
3
3
3
```

---

## **ğŸ” ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º**

## **var**

## **æ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œè€Œä¸”æœ‰å£°æ˜æå‡**

### **è¿™æ®µä»£ç ç­‰ä»·äºè¿™æ ·ï¼š**

```js
var i;
for (i = 0; i < 3; i++) {
  setTimeout(() => {
    console.log(i);
  }, 1000);
}
```

- æ‰€æœ‰ `setTimeout` é—­åŒ…éƒ½å¼•ç”¨äº†**åŒä¸€ä¸ªå˜é‡ i**
- å½“ 1 ç§’åå‡½æ•°è¿è¡Œæ—¶ï¼Œå¾ªç¯å·²ç»ç»“æŸï¼Œ`i === 3`

---

## **âœ… æ­£ç¡®å†™æ³•ä¸€ï¼šç”¨**

## **letï¼ˆæ¯æ¬¡å¾ªç¯éƒ½æ˜¯æ–°çš„å˜é‡ï¼‰**

```js
for (let i = 0; i < 3; i++) {
  setTimeout(() => {
    console.log(i); // è¾“å‡º 0, 1, 2
  }, 1000);
}
```

- `let` æ˜¯**å—çº§ä½œç”¨åŸŸ**
- æ¯æ¬¡å¾ªç¯éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ iï¼Œé—­åŒ…å„è‡ªè®°ä½è‡ªå·±çš„é‚£ä¸ªç‰ˆæœ¬

---

## **âœ… æ­£ç¡®å†™æ³•äºŒï¼ˆIIFEï¼‰ï¼š**

```js
for (var i = 0; i < 3; i++) {
  (function(j) {
    setTimeout(() => {
      console.log(j);
    }, 1000);
  })(i);
}
```

---

## **âœ… æ€»ç»“å£è¯€**

| **ç‚¹** | **è®°ä½è¿™å¥è¯** |
| --- | --- |
| é—­åŒ…æ˜¯ä»€ä¹ˆ | å‡½æ•°è®°ä½äº†å®šä¹‰æ—¶çš„ä½œç”¨åŸŸå˜é‡ |
| var çš„ä½œç”¨åŸŸ | æ•´ä¸ªå‡½æ•°é€šç”¨ï¼Œå¾ªç¯é‡Œä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ |
| å¸¸è§é”™è¯¯ | å¤šä¸ªé—­åŒ…å…±äº«åŒä¸€ä¸ª varï¼Œå°±ä¼šä¸€èµ·è¾“å‡ºåŒä¸€ä¸ªå€¼ |
| æ­£ç¡®åšæ³• | ç”¨ letã€æˆ– IIFE åˆ›å»ºç‹¬ç«‹ä½œç”¨åŸŸ |